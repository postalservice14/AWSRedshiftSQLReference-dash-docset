<!DOCTYPE html>
<html>
<head>
    <link href="css/awsdocs.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/awsdocs.min.js"></script>
    <meta charset="utf-8">
</head>
<body>
    <div id="content" style="padding: 10px 30px;">
    <div></div><h1 class="topictitle" id="declare">DECLARE</h1><p>Defines a new cursor. Use a cursor to retrieve a few rows at a time from the result
                        set
                        of a larger query. 
                     </p><p>When the first row of a cursor is fetched, the entire result set is materialized on
                        the
                        leader node, in memory or on disk, if needed. Because of the potential negative performance
                        impact of using cursors with large result sets, we recommend using alternative approaches
                        whenever possible. For more information, see <a href="declare.html#declare-performance">Performance Considerations When Using
                           Cursors</a>.
                     </p><p>You must declare a cursor within a transaction block. Only one cursor at a time can
                        be
                        open per session. 
                     </p><p>For more information, see <a href="fetch.html">FETCH</a>, <a href="close.html">CLOSE</a>.
                     </p><h2 id="declare-synopsis">Syntax</h2><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">DECLARE <em>cursor_name</em> CURSOR FOR <em>query</em></code></pre><h2 id="declare-parameters">Parameters</h2><div class="variablelist">
                        
                        
                        
                        <dl>
                           
                           <dt><span class="term"><em>cursor_name</em>
                                 </span></dt>
                           
                           <dd>
                              
                              <p>Name of the new cursor. </p>
                              
                           </dd>
                           
                           
                           <dt><span class="term">
                                 <em>query</em>
                                 </span></dt>
                           
                           <dd>
                              
                              <p>A SELECT statement that populates the cursor.</p>
                              
                           </dd>
                           
                        </dl>
                     </div><h2 id="declare-usage">DECLARE CURSOR Usage Notes</h2><p>If your client application uses an ODBC connection and your query creates a result
                        set that is too large to fit in memory, you can stream the result set to your client
                        application by using a cursor. When you use a cursor, the entire result set is
                        materialized on the leader node, and then your client can fetch the results
                        incrementally. 
                     </p><div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>To enable cursors in ODBC for Microsoft Windows, enable the <b>Use
                              Declare/Fetch</b> option in the ODBC DSN you use for Amazon Redshift. We recommend
                           setting the ODBC cache size, using the <b>Cache Size</b> field in the
                           ODBC DSN options dialog, to 4,000 or greater on multi-node clusters to minimize round
                           trips. On a single-node cluster, set Cache Size to 1,000.
                        </p>
                     </div><p>Because of the potential negative performance impact of using cursors, we recommend
                        using alternative approaches whenever possible. For more information, see <a href="declare.html#declare-performance">Performance Considerations When Using
                           Cursors</a>.
                     </p><p>Amazon Redshift cursors are supported with the following limitations:</p><div class="itemizedlist">
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>Only one cursor at a time can be open per session. </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>Cursors must be used within a transaction (BEGIN &#x2026; END). </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>The maximum cumulative result set size for all cursors is constrained based on
                                 the cluster node type. If you need larger result sets, you can resize to an XL or
                                 8XL node configuration.
                              </p>
                              
                              <p>For more information, see <a href="declare.html#declare-constraints">Cursor Constraints</a>. 
                              </p>
                              
                           </li>
                        </ul>
                     </div><h2 id="declare-constraints">Cursor Constraints</h2><p>When the first row of a cursor is fetched, the entire result set is materialized on
                        the leader node. If the result set does not fit in memory, it is written to disk as
                        needed. To protect the integrity of the leader node, Amazon Redshift enforces constraints
                        on
                        the size of all cursor result sets, based on the cluster&apos;s node type.
                     </p><p>The following table shows the maximum total result set size for each cluster node
                        type. Maximum result set sizes are in megabytes.
                     </p><div class="table">
                        <div class="table-contents">
                           <table id="w278aac41b9c87c17b7">
                              
                              <tr>
                                 
                                 <th>Node type</th>
                                 
                                 <th>Maximum result set per cluster (MB)</th>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p> DS1 or DS2 XL single node </p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p> 64000 </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p> DS1 or DS2 XL multiple nodes </p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p> 1800000 </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p> DS1 or DS2 8XL multiple nodes </p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p> 14400000 </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p> DC1 Large single node </p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p> 16000 </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p> DC1 Large multiple nodes </p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p> 384000 </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p> DC1 8XL multiple nodes </p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p> 3000000 </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p> DC2 Large single node </p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p> 8000 </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p> DC2 Large multiple nodes </p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p> 192000 </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p> DC2 8XL multiple nodes </p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p> 3200000 </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                           </table>
                        </div>
                     </div><p>To view the active cursor configuration for a cluster, query the <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_STV_CURSOR_CONFIGURATION.html">STV_CURSOR_CONFIGURATION</a>
                        system table as a superuser. To view the state of active cursors, query the <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_STV_ACTIVE_CURSORS.html">STV_ACTIVE_CURSORS</a> system table.
                        Only the rows for a user&apos;s own cursors are visible to the user, but a superuser can
                        view
                        all cursors.
                     </p><h2 id="declare-performance">Performance Considerations When Using
                        Cursors
                     </h2><p>Because cursors materialize the entire result set on the leader node before beginning
                        to return results to the client, using cursors with very large result sets can have
                        a
                        negative impact on performance. We strongly recommend against using cursors with very
                        large result sets. In some cases, such as when your application uses an ODBC connection,
                        cursors might be the only feasible solution. If possible, we recommend using these
                        alternatives:
                     </p><div class="itemizedlist">
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>Use <a href="r_UNLOAD.html">UNLOAD</a> to export a large
                                 table. When you use UNLOAD, the compute nodes work in parallel to transfer the
                                 data directly to data files on Amazon Simple Storage Service. For more information,
                                 see <a href="https://docs.aws.amazon.com/redshift/latest/dg/c_unloading_data.html">Unloading Data</a>. 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>Set the JDBC fetch size parameter in your client application. If you use a JDBC
                                 connection and you are encountering client-side out-of-memory errors, you can
                                 enable your client to retrieve result sets in smaller batches by setting the JDBC
                                 fetch size parameter. For more information, see <a href="https://docs.aws.amazon.com/redshift/latest/dg/queries-troubleshooting.html#set-the-JDBC-fetch-size-parameter">Setting the JDBC Fetch Size
                                    Parameter</a>. 
                              </p>
                              
                           </li>
                        </ul>
                     </div><h2 id="declare-example">DECLARE CURSOR Example</h2><p>The following example declares a cursor named LOLLAPALOOZA to select sales
                        information for the Lollapalooza event, and then fetches rows from the result set
                        using
                        the cursor:
                     </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">-- Begin a transaction

begin;

-- Declare a cursor

declare lollapalooza cursor for 
select eventname, starttime, pricepaid/qtysold as costperticket, qtysold
from sales, event
where sales.eventid = event.eventid
and eventname=&apos;Lollapalooza&apos;;

-- Fetch the first 5 rows in the cursor lollapalooza:

fetch forward 5 from lollapalooza;

  eventname   |      starttime      | costperticket | qtysold
--------------+---------------------+---------------+---------
 Lollapalooza | 2008-05-01 19:00:00 |   92.00000000 |       3
 Lollapalooza | 2008-11-15 15:00:00 |  222.00000000 |       2
 Lollapalooza | 2008-04-17 15:00:00 |  239.00000000 |       3
 Lollapalooza | 2008-04-17 15:00:00 |  239.00000000 |       4
 Lollapalooza | 2008-04-17 15:00:00 |  239.00000000 |       1
(5 rows)

-- Fetch the next row:

fetch next from lollapalooza;

  eventname   |      starttime      | costperticket | qtysold
--------------+---------------------+---------------+---------
 Lollapalooza | 2008-10-06 14:00:00 |  114.00000000 |       2

-- Close the cursor and end the transaction:

close lollapalooza;
commit;
</code></pre><div id="marketing-target"><span class="close-button"></span><div class="marketing-title" id="marketing-title"></div>
                        <div class="marketing-description"><span id="marketing-description"></span><span id="marketing-cta"></span></div>
                     </div></div>
</body>
</html>