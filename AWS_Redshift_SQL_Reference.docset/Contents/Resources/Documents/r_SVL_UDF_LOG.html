<!DOCTYPE html>
<html>
<head>
    <link href="css/awsdocs.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/awsdocs.min.js"></script>
    <meta charset="utf-8">
</head>
<body>
    <div id="content" style="padding: 10px 30px;">
    <div></div><h1 class="topictitle" id="r_SVL_UDF_LOG">SVL_UDF_LOG</h1><p> Records system-defined error and warning messages generating
                        during user-defined function (UDF) execution.
                        
                     </p><p>This view is visible to all users. Superusers can see all rows; regular users can
                        see only their own data. For more information, see <a href="https://docs.aws.amazon.com/redshift/latest/dg/c_visibility-of-data.html">Visibility of Data in System Tables and
                           Views</a>. 
                     </p><h2 id="SVL_UDF_LOG-table-columns">Table Columns</h2><div class="table">
                        <div class="table-contents">
                           <table id="w278aac43c15c99b7b3">
                              
                              <tr>
                                 
                                 <th>Column Name </th>
                                 
                                 <th>Data Type </th>
                                 
                                 <th>Description </th>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td>query</td>
                                 
                                 <td>bigint</td>
                                 
                                 <td>The query ID. You can use this ID to join various
                                    other system tables and views.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>message</td>
                                 
                                 <td>char(4096)</td>
                                 
                                 <td>The message generated by the function.</td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>created</td>
                                 
                                 <td>timestamp</td>
                                 
                                 <td>The time that the log was created.</td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>traceback</td>
                                 
                                 <td>char(4096)</td>
                                 
                                 <td>If available, this value provides a stack
                                    traceback for the UDF. For more information, see <a href="https://docs.python.org/2/library/traceback.html" target="_blank">traceback</a> in the Python Standard Library. 
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>funcname </td>
                                 
                                 <td>character(256)</td>
                                 
                                 <td>The name of the UDF that is executing.</td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>node </td>
                                 
                                 <td>integer</td>
                                 
                                 <td>The node where the message was generated.</td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>slice</td>
                                 
                                 <td>integer</td>
                                 
                                 <td>The slice where the message was generated.</td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>seq</td>
                                 
                                 <td>integer</td>
                                 
                                 <td>The sequence of the message on the slice.</td>
                                 
                              </tr>
                              
                           </table>
                        </div>
                     </div><h2 id="SVL_UDF_LOG-sample-queries">Sample Queries</h2><p>The following example shows how UDFs handle system-defined errors. The first block
                        shows the definition for a UDF function that returns the inverse of an argument.
                        When you run the function and provide a 0 argument, as the second block shows, the
                        function returns an error. The third statement reads the error message that is
                        logged in SVL_UDF_LOG
                     </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">-- Create a function to find the inverse of a number

CREATE OR REPLACE FUNCTION  f_udf_inv(a int)
  RETURNS float IMMUTABLE
AS $$
   return 1/a
$$ LANGUAGE plpythonu;

-- Run the function with a 0 argument to create an error
Select f_udf_inv(0) from sales;

-- Query SVL_UDF_LOG to view the message

Select query, created, message::varchar
from svl_udf_log;

 query |          created           | message                             
-------+----------------------------+---------------------------------------------------------
  2211 | 2015-08-22 00:11:12.04819  | ZeroDivisionError: long division or modulo by zero\nNone  </code></pre><p>The following example adds logging and a warning message to the UDF so that a
                        divide by zero operation results in a warning message instead of stopping with an
                        error message. 
                     </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">-- Create a function to find the inverse of a number and log a warning

CREATE OR REPLACE FUNCTION f_udf_inv_log(a int)
  RETURNS float IMMUTABLE
 AS $$ 
  import logging
  logger = logging.getLogger() #get root logger
  if a==0:
    logger.warning(&apos;You attempted to divide by zero.\nReturning zero instead of error.\n&apos;) 
    return 0
  else:
     return 1/a
$$ LANGUAGE plpythonu;</code></pre><p>The following example runs the function, then queries SVL_UDF_LOG to view the
                        message.
                     </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">
-- Run the function with a 0 argument to trigger the warning
Select f_udf_inv_log(0) from sales;

-- Query SVL_UDF_LOG to view the message

Select query, created, message::varchar
from svl_udf_log;

query |          created           | message                             
------+----------------------------+----------------------------------
    0 | 2015-08-22 00:11:12.04819  | You attempted to divide by zero. 
                                     Returning zero instead of error. 
</code></pre><div id="marketing-target"><span class="close-button"></span><div class="marketing-title" id="marketing-title"></div>
                        <div class="marketing-description"><span id="marketing-description"></span><span id="marketing-cta"></span></div>
                     </div></div>
</body>
</html>